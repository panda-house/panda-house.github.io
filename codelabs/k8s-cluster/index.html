
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>k8s集群一键安装</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="k8s-cluster"
                  title="k8s集群一键安装"
                  environment="web"
                  feedback-link="http://#">
    
      <google-codelab-step label="实验目的" duration="1">
        <p>通过文档指导搭建出一套生产可用k8s集群<br> 采用github上一个基于ansible编写的开源小工具进行搭建,工具支持多master部署<br> 部署模式为二进制部署包<br><a href="https://github.com/easzlab/kubeasz" target="_blank">部署工具参考文档</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="准备工作" duration="5">
        <ol type="1">
<li>服务器要求 操作系统: centos7 配置最低要求cpu: 2c memeory: 4g disk: 40g<br> 服务器能相互通信，且能上互联网<br></li>
<li>服务器规划 此处作为演示环境，准备三台机器验证集群安装<br></li>
</ol>
<p class="image-container"><img alt="cluster" src="img/9026ec93bd8e8ac3.jpg"></p>
<ol type="1">
<li>操作系统升级 <br><code># 文档中脚本默认均以root用户执行<br>yum update<br># 安装python<br>yum install python -y<br></code></li>
<li>配置hosts 三台机器均配置如下  <pre><code>vim /etc/hosts
内容如下： 
192.168.2.82 master
192.168.2.83 node1
192.168.2.86 node12
</code></pre>
</li>
<li>配置免密登陆 三台机器任选一个作为控制机，设置免密登陆，一般选择master节点，如有多余的机器，也可以选择其他机器作为控制机器<br> 此处选择master节点作为控制机，用于部署集群  <pre><code># 在master节点
ssh-keygen  #一路回车就行
ssh-copy-id master -p 22
ssh-copy-id node1 -p 22
ssh-copy-id node2 -p 22
</code></pre>
</li>
</ol>


      </google-codelab-step>
    
      <google-codelab-step label="部署工具安装" duration="5">
        <h2 is-upgraded>安装ansible环境</h2>
<pre><code>yum install git python-pip -y
# pip安装ansible(国内如果安装太慢可以直接用pip阿里云加速)
pip install pip --upgrade -i https://mirrors.aliyun.com/pypi/simple/
pip install ansible==2.6.18 netaddr==0.7.19 -i https://mirrors.aliyun.com/pypi/simple/
</code></pre>
<p>安装成功截图<br><img alt="ansible" src="img/f72cefb95f800188.jpg"></p>
<h2 is-upgraded>工具下载</h2>
<pre><code># 下载工具脚本easzup，举例使用kubeasz版本2.0.2
export release=2.0.2
curl -C- -fLO --retry 3 https://github.com/easzlab/kubeasz/releases/download/${release}/easzup
chmod +x ./easzup
# 使用工具脚本下载
./easzup -D
</code></pre>
<h2 is-upgraded>配置集群参数</h2>
<pre><code>cd /etc/ansible &amp;&amp; cp example/hosts.multi-node hosts, 然后实际情况修改此hosts文件
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="集群安装" duration="0">
        <h2 is-upgraded>分布安装</h2>
<pre><code language="language-dotnetcli" class="language-dotnetcli"># 分步安装
ansible-playbook 01.prepare.yml
ansible-playbook 02.etcd.yml
ansible-playbook 03.docker.yml
ansible-playbook 04.kube-master.yml
ansible-playbook 05.kube-node.yml
ansible-playbook 06.network.yml
ansible-playbook 07.cluster-addon.yml
</code></pre>
<h2 is-upgraded>一键安装</h2>
<pre><code>#ansible-playbook 90.setup.yml
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="集群验证" duration="1">
        <p class="image-container"><img alt="custer" src="img/b0851d62d5cd8c48.jpg"></p>


      </google-codelab-step>
    
      <google-codelab-step label="离线集群搭建" duration="0">
        <p><a href="https://github.com/easzlab/kubeasz/blob/master/docs/setup/offline_install.md" target="_blank">离线文档</a></p>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
